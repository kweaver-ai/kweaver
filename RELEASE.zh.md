# ç‰ˆæœ¬å‘å¸ƒè§„èŒƒ

ä¸­æ–‡ | [English](RELEASE.md)

æœ¬æ–‡æ¡£å®šä¹‰äº† KWeaver é¡¹ç›®çš„ç‰ˆæœ¬ç®¡ç†ã€åˆ†æ”¯ç­–ç•¥å’Œå‘å¸ƒæµç¨‹è§„èŒƒã€‚

---

## ğŸ“‹ ç›®å½•

- [åˆ†æ”¯ç­–ç•¥](#-åˆ†æ”¯ç­–ç•¥)
- [ç‰ˆæœ¬å·è§„èŒƒ](#-ç‰ˆæœ¬å·è§„èŒƒ)
- [å‘å¸ƒæµç¨‹](#-å‘å¸ƒæµç¨‹)
- [Changelog è§„èŒƒ](#-changelog-è§„èŒƒ)
- [Backport ç­–ç•¥](#-backport-ç­–ç•¥)

---

## ğŸŒ¿ åˆ†æ”¯ç­–ç•¥

### Trunk-based Development

KWeaver é‡‡ç”¨ **Trunk-based Development** æ¨¡å‹ï¼Œæ ¸å¿ƒåŸåˆ™ï¼š

| åŸåˆ™ | è¯´æ˜ |
| --- | --- |
| **main æ°¸è¿œå¯å‘å¸ƒ** | `main` åˆ†æ”¯å§‹ç»ˆä¿æŒå¯å‘å¸ƒçŠ¶æ€ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä» `main` åˆ›å»º release |
| **çŸ­ç”Ÿå‘½å‘¨æœŸåˆ†æ”¯** | åŠŸèƒ½åˆ†æ”¯å’Œä¿®å¤åˆ†æ”¯åº”å°½é‡çŸ­å°ï¼Œé€šå¸¸ä¸è¶…è¿‡ 2-3 å¤© |
| **å° PR** | æ¯ä¸ª PR åº”èšç„¦å•ä¸€èŒè´£ï¼Œä¾¿äº review å’Œå›æ»š |

### åˆ†æ”¯å‘½åè§„èŒƒ

| åˆ†æ”¯ç±»å‹ | å‘½åæ ¼å¼ | è¯´æ˜ | ç¤ºä¾‹ |
| --- | --- | --- | --- |
| ä¸»åˆ†æ”¯ | `main` | æ°¸è¿œå¯å‘å¸ƒçš„ä¸»å¹² | `main` |
| åŠŸèƒ½åˆ†æ”¯ | `feature/*` | æ–°åŠŸèƒ½å¼€å‘ | `feature/add-oauth-support` |
| ä¿®å¤åˆ†æ”¯ | `fix/*` | Bug ä¿®å¤ | `fix/memory-leak-in-loader` |
| å‘å¸ƒåˆ†æ”¯ | `release/x.x.x` | å‘å¸ƒå‡†å¤‡ | `release/1.2.0` |
| æ”¯æŒåˆ†æ”¯ | `support/x.y` | é•¿æœŸæ”¯æŒç‰ˆæœ¬çš„ç»´æŠ¤åˆ†æ”¯ | `support/1.2` |

### åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸ

```text
main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                    â”‚                    â”‚
       â”‚ feature/foo        â”‚ fix/bar            â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                    â”‚
              â–¼ (merge & delete)   â–¼ (merge & delete)
```

**æœ€ä½³å®è·µï¼š**

- âœ… ä» `main` åˆ›å»ºåˆ†æ”¯
- âœ… é¢‘ç¹ rebase ä¿æŒä¸ `main` åŒæ­¥
- âœ… åˆå¹¶åç«‹å³åˆ é™¤åˆ†æ”¯
- âŒ é¿å…é•¿æœŸå­˜åœ¨çš„åŠŸèƒ½åˆ†æ”¯
- âŒ é¿å…åˆ†æ”¯ä¹‹é—´ç›¸äº’åˆå¹¶

---

## ğŸ·ï¸ ç‰ˆæœ¬å·è§„èŒƒ

### è¯­ä¹‰åŒ–ç‰ˆæœ¬ (Semantic Versioning)

KWeaver éµå¾ª [Semantic Versioning 2.0.0](https://semver.org/lang/zh-CN/) è§„èŒƒï¼š

```
vMAJOR.MINOR.PATCH[-PRERELEASE]
```

| ç‰ˆæœ¬å· | å«ä¹‰ | ä½•æ—¶é€’å¢ |
| --- | --- | --- |
| **MAJOR** | ä¸»ç‰ˆæœ¬å· | ä¸å…¼å®¹çš„ API å˜æ›´ |
| **MINOR** | æ¬¡ç‰ˆæœ¬å· | å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢ |
| **PATCH** | ä¿®è®¢å· | å‘åå…¼å®¹çš„ Bug ä¿®å¤ |

### é¢„å‘å¸ƒç‰ˆæœ¬

| æ ‡ç­¾æ ¼å¼ | è¯´æ˜ | ç¤ºä¾‹ |
| --- | --- | --- |
| `-alpha.N` | å†…éƒ¨æµ‹è¯•ç‰ˆï¼ŒåŠŸèƒ½ä¸å®Œæ•´ | `v1.2.0-alpha.1` |
| `-beta.N` | å…¬å¼€æµ‹è¯•ç‰ˆï¼ŒåŠŸèƒ½å®Œæ•´ä½†å¯èƒ½æœ‰ Bug | `v1.2.0-beta.1` |
| `-rc.N` | å‘å¸ƒå€™é€‰ç‰ˆï¼Œå‡†å¤‡æ­£å¼å‘å¸ƒ | `v1.2.0-rc.1` |

### Tag è§„èŒƒ

| è§„åˆ™ | è¯´æ˜ |
| --- | --- |
| å‰ç¼€ | å¿…é¡»ä»¥ `v` å¼€å¤´ |
| æ ¼å¼ | `vX.Y.Z` æˆ– `vX.Y.Z-prerelease.N` |
| ç­¾å | æ¨èä½¿ç”¨ GPG ç­¾å tag |

**æ­£ç¡®ç¤ºä¾‹ï¼š**

```bash
# æ­£å¼ç‰ˆæœ¬
git tag -a v1.0.0 -m "Release v1.0.0"

# é¢„å‘å¸ƒç‰ˆæœ¬
git tag -a v1.1.0-rc.1 -m "Release candidate 1 for v1.1.0"

# å¸¦ç­¾åçš„ tag
git tag -s v1.0.0 -m "Release v1.0.0"
```

**é”™è¯¯ç¤ºä¾‹ï¼š**

```bash
# âŒ ç¼ºå°‘ v å‰ç¼€
git tag 1.0.0

# âŒ éæ ‡å‡†é¢„å‘å¸ƒæ ¼å¼
git tag v1.0.0-RC1
git tag v1.0.0.rc.1
```

---

## ğŸš€ å‘å¸ƒæµç¨‹

### è‡ªåŠ¨åŒ–å‘å¸ƒ

KWeaver é‡‡ç”¨ **Tag è§¦å‘** çš„è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ï¼š

```text
å¼€å‘è€… push tag  â†’  CI æ£€æµ‹åˆ° tag  â†’  è¿è¡Œæµ‹è¯•  â†’  æ„å»ºåˆ¶å“  â†’  å‘å¸ƒ Release
```

CI å°†è‡ªåŠ¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

1. âœ… è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
2. âœ… æ„å»ºå„å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶
3. âœ… æ„å»º Docker é•œåƒ
4. âœ… ç”Ÿæˆ Release Notes
5. âœ… å‘å¸ƒåˆ° GitHub Releases
6. âœ… æ¨é€é•œåƒåˆ° Container Registry

### å‘å¸ƒæµç¨‹ (Release With Freeze / RC Flow)

KWeaver é‡‡ç”¨ **å†»ç»“å‘å¸ƒ** æ¨¡å¼ï¼Œæ‰€æœ‰ç‰ˆæœ¬å‘å¸ƒéƒ½éœ€è¦ç»è¿‡ RCï¼ˆRelease Candidateï¼‰éªŒè¯å‘¨æœŸã€‚

```text
main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
              â”‚                                        â–²
              â”‚ åˆ›å»º release åˆ†æ”¯                       â”‚ åˆå¹¶å› main
              â–¼                                        â”‚
         release/1.2.0 â”€â”€â–º rc.1 â”€â”€â–º rc.2 â”€â”€â–º v1.2.0 â”€â”€â”˜
              â”‚              â”‚        â”‚         â”‚
              â”‚         (ä¿®å¤é—®é¢˜) (ä¿®å¤é—®é¢˜)    â”‚
              â”‚              â”‚        â”‚         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    ä»…å…è®¸ bug fix å’Œå‘å¸ƒç›¸å…³æ›´æ”¹
```

### æ­¥éª¤

#### 1. åˆ›å»º Release åˆ†æ”¯

```bash
# ä» main åˆ›å»º release åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b release/1.2.0

# æ¨é€ release åˆ†æ”¯
git push origin release/1.2.0
```

#### 2. ä»£ç å†»ç»“ (Code Freeze)

Release åˆ†æ”¯åˆ›å»ºåè¿›å…¥**ä»£ç å†»ç»“**çŠ¶æ€ï¼š

| å…è®¸ âœ… | ç¦æ­¢ âŒ |
| --- | --- |
| Bug ä¿®å¤ | æ–°åŠŸèƒ½ |
| æ–‡æ¡£æ›´æ–° | é‡æ„ |
| ç‰ˆæœ¬å·æ›´æ–° | æ€§èƒ½ä¼˜åŒ–ï¼ˆé™¤éä¿®å¤é—®é¢˜ï¼‰ |
| é…ç½®è°ƒæ•´ | ä¾èµ–å‡çº§ï¼ˆé™¤éä¿®å¤å®‰å…¨é—®é¢˜ï¼‰ |

#### 3. å‘å¸ƒ RC ç‰ˆæœ¬

```bash
# åœ¨ release åˆ†æ”¯ä¸Šå‘å¸ƒç¬¬ä¸€ä¸ª RC
git checkout release/1.2.0
git tag -a v1.2.0-rc.1 -m "Release candidate 1 for v1.2.0"
git push origin v1.2.0-rc.1

# å¦‚æœ‰é—®é¢˜ä¿®å¤åï¼Œå‘å¸ƒåç»­ RC
git tag -a v1.2.0-rc.2 -m "Release candidate 2 for v1.2.0"
git push origin v1.2.0-rc.2
```

#### 4. RC éªŒè¯

- åœ¨æµ‹è¯•/é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½² RC ç‰ˆæœ¬
- æ‰§è¡Œå®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- è¿›è¡Œç”¨æˆ·éªŒæ”¶æµ‹è¯•ï¼ˆUATï¼‰
- æ”¶é›†åé¦ˆå¹¶ä¿®å¤å‘ç°çš„é—®é¢˜

#### 5. å‘å¸ƒæ­£å¼ç‰ˆæœ¬

```bash
# RC éªŒè¯é€šè¿‡åï¼Œå‘å¸ƒæ­£å¼ç‰ˆæœ¬
git checkout release/1.2.0
git tag -a v1.2.0 -m "Release v1.2.0"
git push origin v1.2.0
```

#### 6. åˆå¹¶å› main

```bash
# å°† release åˆ†æ”¯åˆå¹¶å› main
git checkout main
git pull origin main
git merge release/1.2.0 --no-ff -m "Merge release/1.2.0 into main"
git push origin main

# åˆ é™¤ release åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰
git branch -d release/1.2.0
git push origin --delete release/1.2.0
```

---

### éªŒè¯å‘å¸ƒ

- æ£€æŸ¥ [GitHub Releases](https://github.com/kweaver-ai/kweaver/releases) é¡µé¢
- éªŒè¯åˆ¶å“ä¸‹è½½å’Œå®Œæ•´æ€§
- ç¡®è®¤ Docker é•œåƒå¯æ‹‰å–

### å‘å¸ƒæ£€æŸ¥æ¸…å•

åœ¨åˆ›å»º release tag ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰è®¡åˆ’åŠŸèƒ½å·²åˆå¹¶
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] CHANGELOG.md å·²æ›´æ–°
- [ ] ç‰ˆæœ¬å·ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ
- [ ] æ–‡æ¡£å·²åŒæ­¥æ›´æ–°
- [ ] Breaking Changes å·²åœ¨æ–‡æ¡£ä¸­è¯´æ˜
- [ ] æ‰€æœ‰ RC ç‰ˆæœ¬å·²éªŒè¯é€šè¿‡
- [ ] Release åˆ†æ”¯å·²åˆå¹¶å› main

---

## ğŸ“„ Changelog è§„èŒƒ

### Keep a Changelog

KWeaver éµå¾ª [Keep a Changelog](https://keepachangelog.com/zh-CN/) è§„èŒƒã€‚

### æ–‡ä»¶æ ¼å¼

```markdown
# Changelog

æœ¬é¡¹ç›®æ‰€æœ‰é‡è¦å˜æ›´éƒ½å°†è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚

æ ¼å¼åŸºäº [Keep a Changelog](https://keepachangelog.com/zh-CN/)ï¼Œ
æœ¬é¡¹ç›®éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)ã€‚

## [Unreleased]

### Added
- æ–°å¢çš„åŠŸèƒ½

### Changed
- å˜æ›´çš„åŠŸèƒ½

### Deprecated
- å³å°†åºŸå¼ƒçš„åŠŸèƒ½

### Removed
- å·²ç§»é™¤çš„åŠŸèƒ½

### Fixed
- ä¿®å¤çš„ Bug

### Security
- å®‰å…¨ç›¸å…³çš„ä¿®å¤

## [1.1.0] - 2025-01-09

### Added
- æ–°å¢ OAuth 2.0 è®¤è¯æ”¯æŒ (#123)
- æ–°å¢æ‰¹é‡å¯¼å…¥åŠŸèƒ½ (#456)

### Fixed
- ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜ (#789)

## [1.0.0] - 2024-12-01

### Added
- é¦–æ¬¡å‘å¸ƒ
```

### å˜æ›´ç±»å‹

| ç±»å‹ | è¯´æ˜ |
| --- | --- |
| **Added** | æ–°å¢åŠŸèƒ½ |
| **Changed** | åŠŸèƒ½å˜æ›´ |
| **Deprecated** | å³å°†åºŸå¼ƒï¼ˆä¸‹ä¸ªä¸»ç‰ˆæœ¬ç§»é™¤ï¼‰ |
| **Removed** | å·²ç§»é™¤åŠŸèƒ½ |
| **Fixed** | Bug ä¿®å¤ |
| **Security** | å®‰å…¨æ¼æ´ä¿®å¤ |

### ç¼–å†™è§„èŒƒ

- âœ… æ¯æ¡è®°å½•å…³è” PR æˆ– Issue ç¼–å·
- âœ… æŒ‰å˜æ›´ç±»å‹åˆ†ç±»
- âœ… ä½¿ç”¨ç”¨æˆ·å¯ç†è§£çš„è¯­è¨€æè¿°
- âœ… Breaking Changes æ”¾åœ¨æ˜¾è‘—ä½ç½®å¹¶åŠ ç²—
- âŒ ä¸è¦åŒ…å«å†…éƒ¨é‡æ„ç»†èŠ‚ï¼ˆé™¤éå½±å“ç”¨æˆ·ï¼‰
- âŒ ä¸è¦åŒ…å« CI/æµ‹è¯•ç›¸å…³å˜æ›´

---

## ğŸ”„ Backport ç­–ç•¥

### ä½•æ—¶éœ€è¦ Backport

Backport ä»…é€‚ç”¨äº **é•¿æœŸæ”¯æŒ (LTS)** ç‰ˆæœ¬çš„ç»´æŠ¤åˆ†æ”¯ï¼š

| åœºæ™¯ | æ˜¯å¦ Backport |
| --- | --- |
| å®‰å…¨æ¼æ´ä¿®å¤ | âœ… å¿…é¡» |
| ä¸¥é‡ Bug ä¿®å¤ | âœ… æ¨è |
| ä¸€èˆ¬ Bug ä¿®å¤ | âš ï¸ è§†æƒ…å†µ |
| æ–°åŠŸèƒ½ | âŒ ä¸ Backport |
| é‡æ„ | âŒ ä¸ Backport |

### æ”¯æŒåˆ†æ”¯å‘½å

```
support/x.y
```

ä¾‹å¦‚ï¼š`support/1.2` ç”¨äºç»´æŠ¤ 1.2.x ç³»åˆ—ç‰ˆæœ¬ã€‚

### Backport æµç¨‹

#### 1. åœ¨ main ä¸Šå…ˆä¿®å¤

```bash
# åœ¨ main ä¸Šåˆ›å»ºä¿®å¤åˆ†æ”¯
git checkout main
git checkout -b fix/security-issue-123

# æäº¤ä¿®å¤
git commit -m "fix(auth): patch security vulnerability CVE-2025-XXXX"

# åˆå¹¶åˆ° main
# è®°å½•åˆå¹¶åçš„ commit hash å’Œ PR ç¼–å·
```

#### 2. Cherry-pick åˆ°æ”¯æŒåˆ†æ”¯

```bash
# åˆ‡æ¢åˆ°æ”¯æŒåˆ†æ”¯
git checkout support/1.2

# Cherry-pick ä¿®å¤æäº¤
git cherry-pick -x <commit-hash>

# -x å‚æ•°ä¼šè‡ªåŠ¨æ·»åŠ  cherry-pick æ¥æºä¿¡æ¯
```

#### 3. è®°å½• Backport ä¿¡æ¯

åœ¨ commit message ä¸­æ·»åŠ åŸå§‹ PR é“¾æ¥ï¼š

```bash
git commit --amend

# åœ¨ commit message ä¸­æ·»åŠ ï¼š
# (cherry picked from commit abc1234)
# Backport of #123
```

#### 4. åˆ›å»º Patch ç‰ˆæœ¬

```bash
# åœ¨æ”¯æŒåˆ†æ”¯ä¸Šåˆ›å»ºè¡¥ä¸ç‰ˆæœ¬
git tag -a v1.2.1 -m "Release v1.2.1 (security patch)"
git push origin v1.2.1
```

### Backport æ£€æŸ¥æ¸…å•

- [ ] ä¿®å¤å·²åœ¨ `main` åˆ†æ”¯éªŒè¯
- [ ] ä½¿ç”¨ `cherry-pick -x` ä¿ç•™æ¥æºä¿¡æ¯
- [ ] commit message åŒ…å«åŸå§‹ PR é“¾æ¥
- [ ] æ”¯æŒåˆ†æ”¯çš„ CHANGELOG å·²æ›´æ–°
- [ ] Patch ç‰ˆæœ¬å·æ­£ç¡®é€’å¢

---

## ğŸ“š ç›¸å…³èµ„æº

- [Semantic Versioning](https://semver.org/lang/zh-CN/)
- [Conventional Commits](https://www.conventionalcommits.org/zh-hans/)
- [Keep a Changelog](https://keepachangelog.com/zh-CN/)
- [Trunk Based Development](https://trunkbaseddevelopment.com/)

---

*æœ€åæ›´æ–°ï¼š2025-01-09*
