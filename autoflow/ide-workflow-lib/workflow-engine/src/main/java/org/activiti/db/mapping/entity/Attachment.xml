<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.activiti.engine.impl.persistence.entity.AttachmentEntity">

  <!-- ATTACHMENT INSERT -->

  <insert id="insertAttachment" parameterType="org.activiti.engine.impl.persistence.entity.AttachmentEntity">
    insert into ${prefix}t_wf_hi_attachment (id_, rev_, user_id_, name_, description_, type_, task_id_, proc_inst_id_, url_, content_id_, time_)
    values (
      #{id ,jdbcType=VARCHAR},
      1,
      #{userId ,jdbcType=VARCHAR},
      #{name ,jdbcType=VARCHAR},
      #{description ,jdbcType=VARCHAR},
      #{type ,jdbcType=VARCHAR},
      #{taskId ,jdbcType=VARCHAR},
      #{processInstanceId ,jdbcType=VARCHAR},
      #{url ,jdbcType=VARCHAR},
      #{contentId ,jdbcType=VARCHAR},
      #{time ,jdbcType=TIMESTAMP}
    )
  </insert>

  <insert id="bulkInsertAttachment" parameterType="java.util.List">
    insert into ${prefix}t_wf_hi_attachment (id_, rev_, user_id_, name_, description_, type_, task_id_, proc_inst_id_, url_, content_id_, time_)
    values 
      <foreach collection="list" item="attachment" index="index" separator=","> 
        (#{attachment.id ,jdbcType=VARCHAR},
         1,
         #{attachment.userId ,jdbcType=VARCHAR},
         #{attachment.name ,jdbcType=VARCHAR},
         #{attachment.description ,jdbcType=VARCHAR},
         #{attachment.type ,jdbcType=VARCHAR},
         #{attachment.taskId ,jdbcType=VARCHAR},
         #{attachment.processInstanceId ,jdbcType=VARCHAR},
         #{attachment.url ,jdbcType=VARCHAR},
         #{attachment.contentId ,jdbcType=VARCHAR},
         #{attachment.time ,jdbcType=TIMESTAMP})
      </foreach>
  </insert>

  <insert id="bulkInsertAttachment_oracle" parameterType="java.util.List">
    insert all 
      <foreach collection="list" item="attachment" index="index"> 
        into ${prefix}t_wf_hi_attachment (id_, rev_, user_id_, name_, description_, type_, task_id_, proc_inst_id_, url_, content_id_, time_) values 
          (#{attachment.id ,jdbcType=VARCHAR},
           1,
           #{attachment.userId ,jdbcType=VARCHAR},
           #{attachment.name ,jdbcType=VARCHAR},
           #{attachment.description ,jdbcType=VARCHAR},
           #{attachment.type ,jdbcType=VARCHAR},
           #{attachment.taskId ,jdbcType=VARCHAR},
           #{attachment.processInstanceId ,jdbcType=VARCHAR},
           #{attachment.url ,jdbcType=VARCHAR},
           #{attachment.contentId ,jdbcType=VARCHAR},
           #{attachment.time ,jdbcType=TIMESTAMP})
      </foreach>
    select * from dual
  </insert>

  <!-- ATTACHMENT UPDATE -->

  <update id="updateAttachment" parameterType="org.activiti.engine.impl.persistence.entity.AttachmentEntity">
    update ${prefix}t_wf_hi_attachment 
    set
      rev_ = #{revisionNext, jdbcType=INTEGER},
      name_ = #{name, jdbcType=VARCHAR},
      description_ = #{description, jdbcType=TIMESTAMP}
    where id_ = #{id}
      and rev_ = #{revision, jdbcType=INTEGER}
  </update>

  <!-- ATTACHMENT DELETE -->

  <delete id="deleteAttachment" parameterType="org.activiti.engine.impl.persistence.entity.AttachmentEntity">
    delete from ${prefix}t_wf_hi_attachment 
    where id_ = #{id} and rev_ = #{revision} 
  </delete>
  
  <!-- ATTACHMENT RESULTMAP -->

  <resultMap id="attachmentResultMap" type="org.activiti.engine.impl.persistence.entity.AttachmentEntity">
    <id property="id" column="id_" jdbcType="VARCHAR" />
    <result property="revision" column="rev_" jdbcType="INTEGER" />
    <result property="name" column="name_" jdbcType="VARCHAR" />
    <result property="description" column="description_" jdbcType="VARCHAR" />
    <result property="type" column="type_" jdbcType="VARCHAR" />
    <result property="taskId" column="task_id_" jdbcType="VARCHAR" />
    <result property="processInstanceId" column="proc_inst_id_" jdbcType="VARCHAR" />
    <result property="url" column="url_" jdbcType="VARCHAR" />
    <result property="contentId" column="content_id_" jdbcType="VARCHAR" />
    <result property="userId" column="user_id_" jdbcType="VARCHAR" />
    <result property="time" column="time_" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <!-- ATTACHMENT SELECT -->

  <select id="selectAttachment" parameterType="string" resultMap="attachmentResultMap">
    select *
    from ${prefix}t_wf_hi_attachment
    where ID_ = #{id,jdbcType=VARCHAR}
  </select>
  
  <select id="selectAttachmentsByTaskId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="attachmentResultMap">
    select *
    from ${prefix}t_wf_hi_attachment
    where task_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>
  
  <select id="selectAttachmentsByProcessInstanceId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="attachmentResultMap">
    select *
    from ${prefix}t_wf_hi_attachment
    where proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>

</mapper>
