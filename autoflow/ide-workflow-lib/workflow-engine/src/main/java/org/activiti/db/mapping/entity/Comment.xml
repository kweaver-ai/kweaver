<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.activiti.engine.impl.persistence.entity.CommentEntity">

  <!-- COMMENT INSERT -->

  <insert id="insertComment" parameterType="org.activiti.engine.impl.persistence.entity.CommentEntity">
    insert into ${prefix}t_wf_hi_comment (id_, type_, time_, user_id_, task_id_, proc_inst_id_, action_, message_, full_msg_,display_area,top_proc_inst_id_)
    values (#{id ,jdbcType=VARCHAR},
      #{type ,jdbcType=VARCHAR},
      #{time ,jdbcType=TIMESTAMP},
      #{userId ,jdbcType=VARCHAR},
      #{taskId ,jdbcType=VARCHAR},
      #{processInstanceId ,jdbcType=VARCHAR},
      #{action ,jdbcType=VARCHAR},
      #{message ,jdbcType=VARCHAR},
      #{fullMessageBytes ,jdbcType=BLOB},
      #{displayArea ,jdbcType=VARCHAR},
      #{topProcessInstanceId ,jdbcType=VARCHAR}
    )
  </insert>

  <insert id="insertComment_postgres" parameterType="org.activiti.engine.impl.persistence.entity.CommentEntity">
    insert into ${prefix}t_wf_hi_comment (id_, type_, time_, user_id_, task_id_, proc_inst_id_, action_, message_, full_msg_)
    values (#{id ,jdbcType=VARCHAR},
      #{type ,jdbcType=VARCHAR},
      #{time ,jdbcType=TIMESTAMP},
      #{userId ,jdbcType=VARCHAR},
      #{taskId ,jdbcType=VARCHAR},
      #{processInstanceId ,jdbcType=VARCHAR},
      #{action ,jdbcType=VARCHAR},
      #{message ,jdbcType=VARCHAR},
      #{fullMessageBytes ,jdbcType=BINARY})
  </insert>

  <insert id="bulkInsertComment" parameterType="java.util.List">
    insert into ${prefix}t_wf_hi_comment (id_, type_, time_, user_id_, task_id_, proc_inst_id_, action_, message_, full_msg_)
    values 
      <foreach collection="list" item="comment" index="index" separator=",">
        (#{comment.id ,jdbcType=VARCHAR},
         #{comment.type ,jdbcType=VARCHAR},
         #{comment.time ,jdbcType=TIMESTAMP},
         #{comment.userId ,jdbcType=VARCHAR},
         #{comment.taskId ,jdbcType=VARCHAR},
         #{comment.processInstanceId ,jdbcType=VARCHAR},
         #{comment.action ,jdbcType=VARCHAR},
         #{comment.message ,jdbcType=VARCHAR},
         #{comment.fullMessageBytes ,jdbcType=BLOB})
      </foreach>
  </insert>

  <insert id="bulkInsertComment_oracle" parameterType="java.util.List">
    INSERT ALL 
      <foreach collection="list" item="comment" index="index">
        into ${prefix}T_WF_HI_COMMENT (ID_, TYPE_, TIME_, USER_ID_, TASK_ID_, PROC_INST_ID_, ACTION_, MESSAGE_, FULL_MSG_) VALUES 
          (#{comment.id ,jdbcType=VARCHAR},
           #{comment.type ,jdbcType=VARCHAR},
           #{comment.time ,jdbcType=TIMESTAMP},
           #{comment.userId ,jdbcType=VARCHAR},
           #{comment.taskId ,jdbcType=VARCHAR},
           #{comment.processInstanceId ,jdbcType=VARCHAR},
           #{comment.action ,jdbcType=VARCHAR},
           #{comment.message ,jdbcType=VARCHAR},
           #{comment.fullMessageBytes ,jdbcType=BLOB})
      </foreach>
    SELECT * FROM dual
  </insert>

  <insert id="bulkInsertComment_postgres" parameterType="java.util.List">
    insert into ${prefix}T_WF_HI_COMMENT (ID_, TYPE_, TIME_, USER_ID_, TASK_ID_, PROC_INST_ID_, ACTION_, MESSAGE_, FULL_MSG_)
    values 
      <foreach collection="list" item="comment" index="index" separator=",">
        (#{comment.id ,jdbcType=VARCHAR},
         #{comment.type ,jdbcType=VARCHAR},
         #{comment.time ,jdbcType=TIMESTAMP},
         #{comment.userId ,jdbcType=VARCHAR},
         #{comment.taskId ,jdbcType=VARCHAR},
         #{comment.processInstanceId ,jdbcType=VARCHAR},
         #{comment.action ,jdbcType=VARCHAR},
         #{comment.message ,jdbcType=VARCHAR},
         #{comment.fullMessageBytes ,jdbcType=BINARY})
      </foreach>
  </insert>

  <!-- COMMENT DELETE -->

  <delete id="deleteComment" parameterType="string">
    delete from ${prefix}t_wf_hi_comment where id_ = #{id}
  </delete>

  <delete id="deleteCommentsByTaskId" parameterType="string">
    delete from ${prefix}t_wf_hi_comment where task_id_ = #{taskId} 
  </delete>

  <delete id="deleteCommentsByProcessInstanceId" parameterType="string">
    delete from ${prefix}t_wf_hi_comment where proc_inst_id_ = #{processInstanceId} 
  </delete>
  
  <!-- COMMENT RESULTMAP -->

  <resultMap id="commentResultMap" type="org.activiti.engine.impl.persistence.entity.CommentEntity">
    <id property="id" column="id_" jdbcType="VARCHAR" />
    <result property="type" column="type_" jdbcType="VARCHAR" />
    <result property="userId" column="user_id_" jdbcType="VARCHAR" />
    <result property="time" column="time_" jdbcType="TIMESTAMP" />
    <result property="taskId" column="task_id_" jdbcType="VARCHAR" />
    <result property="processInstanceId" column="proc_inst_id_" jdbcType="VARCHAR" />
    <result property="action" column="action_" jdbcType="VARCHAR" />
    <result property="message" column="message_" jdbcType="VARCHAR" />
    <result property="fullMessageBytes" column="full_msg_" jdbcType="BLOB" />
    <!-- by lw -->
    <result property="displayArea" column="display_area" jdbcType="VARCHAR" />
    <result property="topProcessInstanceId" column="top_proc_inst_id_" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="commentResultMap_postgres" type="org.activiti.engine.impl.persistence.entity.CommentEntity">
    <id property="id" column="id_" jdbcType="VARCHAR" />
    <result property="type" column="type_" jdbcType="VARCHAR" />
    <result property="userId" column="user_id_" jdbcType="VARCHAR" />
    <result property="time" column="time_" jdbcType="TIMESTAMP" />
    <result property="taskId" column="task_id_" jdbcType="VARCHAR" />
    <result property="processInstanceId" column="proc_inst_id_" jdbcType="VARCHAR" />
    <result property="action" column="action_" jdbcType="VARCHAR" />
    <result property="message" column="message_" jdbcType="VARCHAR" />
    <result property="fullMessageBytes" column="full_msg_" jdbcType="BINARY" />
  </resultMap>
  
  <!-- COMMENT SELECT -->

  <select id="selectComment" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where id_ = #{parameter,jdbcType=VARCHAR}
  </select>
  
   <select id="selectComment_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select * 
    from ${prefix}t_wf_hi_comment 
    where id_ = #{parameter,jdbcType=VARCHAR}
  </select>
  <select id="selectCommentsByTaskId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where task_id_ = #{parameter,jdbcType=VARCHAR}
      and type_ = 'comment'
    order by time_ desc
  </select>
  
  <select id="selectCommentsByTaskId_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select * 
    from ${prefix}t_wf_hi_comment 
    where task_id_ = #{parameter,jdbcType=VARCHAR}
      and type_ = 'comment'
    order by time_ desc
  </select>
  
  <select id="selectCommentsByTaskIdAndType" parameterType="java.util.Map" resultMap="commentResultMap">
  	select *
  	from ${prefix}t_wf_hi_comment
  	where task_id_ = #{taskId,jdbcType=VARCHAR}
  		and type_ = #{type,jdbcType=VARCHAR}
  	order by time_ desc
  </select>
  
  <select id="selectCommentsByTaskIdAndType_postgres" parameterType="java.util.Map" resultMap="commentResultMap_postgres">
  	select *
  	from ${prefix}t_wf_hi_comment
  	where task_id_ = #{taskId,jdbcType=VARCHAR}
  		and type_ = #{type,jdbcType=VARCHAR}
  	order by time_ desc
  </select>
  
  <select id="selectCommentsByType" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
  	select *
  	from ${prefix}t_wf_hi_comment
  	where type_ = #{parameter,jdbcType=VARCHAR}
  	order by time_ desc
  </select>
  
  <select id="selectCommentsByType_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
  	select *
  	from ${prefix}t_wf_hi_comment
  	where type_ = #{parameter,jdbcType=VARCHAR}
  	order by time_ desc
  </select>

  <select id="selectEventsByTaskId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where task_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>
  
  <select id="selectEventsByTaskId_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select * 
    from ${prefix}t_wf_hi_comment 
    where task_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>
  
  <select id="selectEventsByProcessInstanceId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>

  <select id="selectEventsByProcessInstanceId_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select * 
    from ${prefix}t_wf_hi_comment 
    where proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>

  <select id="selectCommentsByProcessInstanceId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>

  <select id="selectCommentsByProcessInstanceId_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select * 
    from ${prefix}t_wf_hi_comment 
    where proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>

  <select id="selectCommentsByProcessInstanceIdAndType" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select *
    from ${prefix}t_wf_hi_comment
    where proc_inst_id_ = #{processInstanceId,jdbcType=VARCHAR}
    and type_ = #{type,jdbcType=VARCHAR}
    order by time_ desc
  </select>

  <select id="selectCommentsByProcessInstanceIdAndType_postgres" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap_postgres">
    select *
    from ${prefix}t_wf_hi_comment
    where proc_inst_id_ = #{processInstanceId,jdbcType=VARCHAR}
    and type_ = #{type,jdbcType=VARCHAR}
    order by time_ desc
  </select>
  <!-- by lw -->
 <select id="selectCommentsByTopProcessInstanceId" parameterType="org.activiti.engine.impl.db.ListQueryParameterObject" resultMap="commentResultMap">
    select * 
    from ${prefix}t_wf_hi_comment 
    where top_proc_inst_id_ = #{parameter,jdbcType=VARCHAR}
    order by time_ desc
  </select>
</mapper>
