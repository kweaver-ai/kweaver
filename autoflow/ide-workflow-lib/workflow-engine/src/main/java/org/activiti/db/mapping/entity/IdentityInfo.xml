<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
  
  <!-- INFO INSERT -->

  <insert id="insertIdentityInfo" parameterType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    insert into ${prefix}t_wf_id_info (id_, rev_, user_id_, type_, key_, value_, password_, parent_id_)
    values (
      #{id ,jdbcType=VARCHAR},
      1,
      #{userId ,jdbcType=VARCHAR},
      #{type ,jdbcType=VARCHAR},
      #{key ,jdbcType=VARCHAR},
      #{value ,jdbcType=VARCHAR},
      #{passwordBytes ,jdbcType=BLOB},
      #{parentId ,jdbcType=VARCHAR}
    )
  </insert>

  <insert id="bulkInsertIdentityInfo" parameterType="java.util.List">
    insert into ${prefix}t_wf_id_info (id_, rev_, user_id_, type_, key_, value_, password_, parent_id_)
    values 
      <foreach collection="list" item="identityInfo" index="index" separator=",">
        (#{identityInfo.id ,jdbcType=VARCHAR},
         1,
         #{identityInfo.userId ,jdbcType=VARCHAR},
         #{identityInfo.type ,jdbcType=VARCHAR},
         #{identityInfo.key ,jdbcType=VARCHAR},
         #{identityInfo.value ,jdbcType=VARCHAR},
         #{identityInfo.passwordBytes ,jdbcType=BLOB},
         #{identityInfo.parentId ,jdbcType=VARCHAR})
      </foreach>
  </insert>

  <insert id="bulkInsertIdentityInfo_oracle" parameterType="java.util.List">
    INSERT ALL 
      <foreach collection="list" item="identityInfo" index="index">
        INTO ${prefix}T_WF_ID_INFO (ID_, REV_, USER_ID_, TYPE_, KEY_, VALUE_, PASSWORD_, PARENT_ID_) VALUES
          (#{identityInfo.id ,jdbcType=VARCHAR},
           1,
           #{identityInfo.userId ,jdbcType=VARCHAR},
           #{identityInfo.type ,jdbcType=VARCHAR},
           #{identityInfo.key ,jdbcType=VARCHAR},
           #{identityInfo.value ,jdbcType=VARCHAR},
           #{identityInfo.passwordBytes ,jdbcType=BLOB},
           #{identityInfo.parentId ,jdbcType=VARCHAR})
      </foreach>
    SELECT * FROM dual
  </insert>

   <insert id="insertIdentityInfo_postgres" parameterType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    insert into ${prefix}T_WF_ID_INFO (ID_, REV_, USER_ID_, TYPE_, KEY_, VALUE_, PASSWORD_, PARENT_ID_)
    values (
      #{id ,jdbcType=VARCHAR},
      1,
      #{userId ,jdbcType=VARCHAR},
      #{type ,jdbcType=VARCHAR},
      #{key ,jdbcType=VARCHAR},
      #{value ,jdbcType=VARCHAR},
      #{passwordBytes ,jdbcType=BINARY},
      #{parentId ,jdbcType=VARCHAR}
    )
  </insert>

  <insert id="bulkInsertIdentityInfo_postgres" parameterType="java.util.List">
    insert into ${prefix}T_WF_ID_INFO (ID_, REV_, USER_ID_, TYPE_, KEY_, VALUE_, PASSWORD_, PARENT_ID_)
    values 
      <foreach collection="list" item="identityInfo" index="index" separator=",">
        (#{identityInfo.id ,jdbcType=VARCHAR},
         1,
         #{identityInfo.userId ,jdbcType=VARCHAR},
         #{identityInfo.type ,jdbcType=VARCHAR},
         #{identityInfo.key ,jdbcType=VARCHAR},
         #{identityInfo.value ,jdbcType=VARCHAR},
         #{identityInfo.passwordBytes ,jdbcType=BINARY},
         #{identityInfo.parentId ,jdbcType=VARCHAR})
      </foreach>
  </insert>
  
  <!-- INFO UPDATE -->
  <update id="updateIdentityInfo" parameterType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    update ${prefix}t_wf_id_info
    set rev_ = #{revisionNext ,jdbcType=INTEGER},
        value_ = #{value ,jdbcType=VARCHAR},
        password_ = #{passwordBytes ,jdbcType=BLOB}
    where id_ = #{id}
      and rev_ = #{revision}
  </update>
  
  <update id="updateIdentityInfo_postgres" parameterType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    update ${prefix}T_WF_ID_INFO
    set REV_ = #{revisionNext ,jdbcType=INTEGER},
        VALUE_ = #{value ,jdbcType=VARCHAR},
        PASSWORD_ = #{passwordBytes ,jdbcType=BINARY}
    where ID_ = #{id}
      and REV_ = #{revision}
  </update>
  
  <!-- INFO DELETE -->

  <delete id="deleteIdentityInfo" parameterType="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    delete from ${prefix}t_wf_id_info
    where id_ = #{id} and rev_ = #{revision}
  </delete>

  <!-- INFO RESULTMAP -->

  <resultMap id="identityInfoResultMap" type="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    <id property="id" column="id_" jdbcType="VARCHAR" />
    <result property="revision" column="rev_" jdbcType="INTEGER" />
    <result property="userId" column="user_id_" jdbcType="VARCHAR" />
    <result property="type" column="type_" jdbcType="VARCHAR" />
    <result property="key" column="key_" jdbcType="VARCHAR" />
    <result property="value" column="value_" jdbcType="VARCHAR" />
    <result property="passwordBytes" column="password_" jdbcType="BLOB" />
    <result property="parentId" column="parent_id_" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="identityInfoResultMap_postgres" type="org.activiti.engine.impl.persistence.entity.IdentityInfoEntity">
    <id property="id" column="id_" jdbcType="VARCHAR" />
    <result property="revision" column="rev_" jdbcType="INTEGER" />
    <result property="userId" column="user_id_" jdbcType="VARCHAR" />
    <result property="type" column="type_" jdbcType="VARCHAR" />
    <result property="key" column="key_" jdbcType="VARCHAR" />
    <result property="value" column="value_" jdbcType="VARCHAR" />
    <result property="passwordBytes" column="password_" jdbcType="BINARY" />
    <result property="parentId" column="parent_id_" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- INFO SELECT -->

  <select id="selectIdentityInfoById" parameterType="string" resultMap="identityInfoResultMap">
    select * from ${prefix}t_wf_id_info where id_ = #{id,jdbcType=VARCHAR}
  </select>
  
  <select id="selectIdentityInfoById_postgres" parameterType="string" resultMap="identityInfoResultMap_postgres">
    select * from ${prefix}t_wf_id_info where id_ = #{id,jdbcType=VARCHAR}
  </select>
  
  <select id="selectIdentityInfoByUserIdAndKey" parameterType="map" resultMap="identityInfoResultMap">
    select * from ${prefix}t_wf_id_info
    where user_id_ = #{userId,jdbcType=VARCHAR}
      and key_ =  #{key,jdbcType=VARCHAR}
      and parent_id_ is null
  </select>
  
   <select id="selectIdentityInfoByUserIdAndKey_postgres" parameterType="map" resultMap="identityInfoResultMap_postgres">
    select * from ${prefix}t_wf_id_info
    where user_id_ = #{userId,jdbcType=VARCHAR}
      and key_ =  #{key,jdbcType=VARCHAR}
      and parent_id_ is null
  </select>
  
  <select id="selectIdentityInfoKeysByUserIdAndType" parameterType="map" resultType="string">
    select key_ from ${prefix}t_wf_id_info
    where user_id_ = #{userId,jdbcType=VARCHAR}
      and type_ =  #{type,jdbcType=VARCHAR}
      and parent_id_ is null
  </select>
  
  <select id="selectIdentityInfoByUserId" parameterType="string" resultMap="identityInfoResultMap">
    select * from ${prefix}t_wf_id_info where user_id_ = #{parameter,jdbcType=VARCHAR}
  </select>
  
  <select id="selectIdentityInfoByUserId_postgres" parameterType="string" resultMap="identityInfoResultMap_postgres">
    select * from ${prefix}t_wf_id_info where user_id_ = #{parameter,jdbcType=VARCHAR}
  </select>

  <select id="selectIdentityInfoDetails" parameterType="string" resultMap="identityInfoResultMap">
    select * from ${prefix}t_wf_id_info where parent_id_ = #{parameter,jdbcType=VARCHAR}
  </select>

  <select id="selectIdentityInfoDetails_postgres" parameterType="string" resultMap="identityInfoResultMap_postgres">
    select * from ${prefix}t_wf_id_info where parent_id_ = #{parameter,jdbcType=VARCHAR}
  </select>
  
  
</mapper>