# Makefileä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ¨¡æ¿APIæµ‹è¯•å¥—ä»¶ä¸­Makefileçš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¯ç”¨å‘½ä»¤ã€å‚æ•°é…ç½®å’Œä½¿ç”¨ç¤ºä¾‹ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# åˆ›å»ºæµ‹è¯•ç›®å½•ç»“æ„
make create-dirs

# å¯åŠ¨æœåŠ¡
make start-service

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
make health-check

# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
make test-all

# ç”Ÿæˆæ‰€æœ‰HTMLæŠ¥å‘Š
make report-all
```

## ğŸ“ ç›®å½•ç»“æ„

Makefileä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
api_test/tpl/
â”œâ”€â”€ create/          # åˆ›å»ºæ¨¡æ¿æµ‹è¯•
â”œâ”€â”€ list/            # æ¨¡æ¿åˆ—è¡¨æµ‹è¯•
â”œâ”€â”€ detail/          # æ¨¡æ¿è¯¦æƒ…æµ‹è¯•
â”œâ”€â”€ update/          # æ›´æ–°æ¨¡æ¿æµ‹è¯•
â”œâ”€â”€ delete/          # åˆ é™¤æ¨¡æ¿æµ‹è¯•
â”œâ”€â”€ publish/         # å‘å¸ƒç®¡ç†æµ‹è¯•
â”œâ”€â”€ copy/            # å¤åˆ¶æ¨¡æ¿æµ‹è¯•
â”œâ”€â”€ publish_info/    # å‘å¸ƒä¿¡æ¯æµ‹è¯•
â”œâ”€â”€ reports/         # æµ‹è¯•æŠ¥å‘Šç›®å½•
â””â”€â”€ docs/            # æ–‡æ¡£ç›®å½•
```

## âš™ï¸ é…ç½®å˜é‡

### ç¯å¢ƒå˜é‡
```bash
# APIæµ‹è¯•å·¥å…·è·¯å¾„
TOOL_PATH = /Users/Zhuanz/Work/as/dip_ws/agent-go-common-pkg/tool/apitesttool

# æµ‹è¯•ç›®å½•
TEST_DIR = .

# æœåŠ¡URL
SERVICE_URL = http://127.0.0.1:13021
```

### é¢œè‰²é…ç½®
```bash
GREEN = \033[0;32m    # ç»¿è‰²ï¼ˆæˆåŠŸï¼‰
YELLOW = \033[1;33m   # é»„è‰²ï¼ˆè­¦å‘Šï¼‰
RED = \033[0;31m      # çº¢è‰²ï¼ˆé”™è¯¯ï¼‰
NC = \033[0m          # æ— é¢œè‰²
```

## ğŸ› ï¸ æœåŠ¡ç®¡ç†å‘½ä»¤

### å¯åŠ¨æœåŠ¡
```bash
make start-service
```
- **åŠŸèƒ½**: å¯åŠ¨agent-factoryæœåŠ¡
- **ç«¯å£**: 13021
- **ç¯å¢ƒå˜é‡**: è‡ªåŠ¨è®¾ç½®SERVICE_NAME=agent-factory
- **åå°è¿è¡Œ**: æ˜¯

### åœæ­¢æœåŠ¡
```bash
make stop-service
```
- **åŠŸèƒ½**: åœæ­¢å ç”¨13021ç«¯å£çš„æ‰€æœ‰è¿›ç¨‹
- **æ–¹æ³•**: ä½¿ç”¨lsofæŸ¥æ‰¾è¿›ç¨‹å¹¶kill
- **å®‰å…¨æ€§**: ä½¿ç”¨kill -9å¼ºåˆ¶ç»ˆæ­¢

### å¥åº·æ£€æŸ¥
```bash
make health-check
```
- **åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- **æ£€æŸ¥æ–¹å¼**: è®¿é—®/health/readyç«¯ç‚¹
- **è¾“å‡º**: ç»¿è‰²âœ“è¡¨ç¤ºæ­£å¸¸ï¼Œçº¢è‰²âœ—è¡¨ç¤ºå¼‚å¸¸

## ğŸ§ª æµ‹è¯•æ‰§è¡Œå‘½ä»¤

### æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
```bash
make test-all
```
- **åŒ…å«æµ‹è¯•**: é«˜çº§åŠŸèƒ½ã€å®Œæ•´å¥—ä»¶ã€æ‰€æœ‰å•é¡¹åŠŸèƒ½æµ‹è¯•
- **æ‰§è¡Œé¡ºåº**: æŒ‰ä¾èµ–å…³ç³»é¡ºåºæ‰§è¡Œ
- **å¤±è´¥å¤„ç†**: ç»§ç»­æ‰§è¡Œå…¶ä»–æµ‹è¯•

### æ‰§è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
```bash
# é«˜çº§åŠŸèƒ½æµ‹è¯•
make test-advanced

# å®Œæ•´æµ‹è¯•å¥—ä»¶
make test-complete
```

### æ‰§è¡Œå•é¡¹åŠŸèƒ½æµ‹è¯•
```bash
# åˆ›å»ºæ¨¡æ¿æµ‹è¯•
make test-create

# æ¨¡æ¿åˆ—è¡¨æµ‹è¯•
make test-list

# æ¨¡æ¿è¯¦æƒ…æµ‹è¯•
make test-detail

# æ›´æ–°æ¨¡æ¿æµ‹è¯•
make test-update

# åˆ é™¤æ¨¡æ¿æµ‹è¯•
make test-delete

# å‘å¸ƒç®¡ç†æµ‹è¯•
make test-publish

# å¤åˆ¶æ¨¡æ¿æµ‹è¯•
make test-copy

# å‘å¸ƒä¿¡æ¯æµ‹è¯•
make test-publish-info
```

## ğŸ“Š æŠ¥å‘Šç”Ÿæˆå‘½ä»¤

### ç”Ÿæˆæ‰€æœ‰HTMLæŠ¥å‘Š
```bash
make report-all
```
- **åŠŸèƒ½**: ç”Ÿæˆæ‰€æœ‰æµ‹è¯•çš„HTMLæŠ¥å‘Š
- **è¾“å‡ºç›®å½•**: `reports/`å’Œå„åŠŸèƒ½ç›®å½•
- **è‡ªåŠ¨æ‰§è¡Œ**: å®Œæˆåè‡ªåŠ¨åˆ—å‡ºæ‰€æœ‰æŠ¥å‘Šæ–‡ä»¶

### ç”Ÿæˆç‰¹å®šæŠ¥å‘Š
```bash
# é«˜çº§åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š
make report-advanced

# å®Œæ•´æµ‹è¯•å¥—ä»¶æŠ¥å‘Š
make report-complete

# å•é¡¹åŠŸèƒ½æŠ¥å‘Š
make report-create
make report-list
make report-detail
make report-update
make report-delete
make report-publish
make report-copy
make report-publish-info
```

### æŠ¥å‘Šæ–‡ä»¶ä½ç½®
- **é›†ä¸­æŠ¥å‘Š**: `reports/advanced_features_report.html`
- **é›†ä¸­æŠ¥å‘Š**: `reports/complete_suite_report.html`
- **åˆ†æ•£æŠ¥å‘Š**: `{åŠŸèƒ½ç›®å½•}/{åŠŸèƒ½}_test_report.html`

## ğŸ”§ å·¥å…·å‘½ä»¤

### åˆ›å»ºç›®å½•ç»“æ„
```bash
make create-dirs
```
- **åŠŸèƒ½**: åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„æµ‹è¯•ç›®å½•
- **ç›®å½•**: create, list, detail, update, delete, publish, copy, publish_info, reports, docs

### åˆ—å‡ºæŠ¥å‘Šæ–‡ä»¶
```bash
make list-reports
```
- **åŠŸèƒ½**: åˆ—å‡ºæ‰€æœ‰ç”Ÿæˆçš„HTMLæŠ¥å‘Šæ–‡ä»¶
- **ä¿¡æ¯**: æ–‡ä»¶è·¯å¾„å’Œå¤§å°
- **æ’åº**: æŒ‰è·¯å¾„æ’åº

### æ¸…ç†æŠ¥å‘Šæ–‡ä»¶
```bash
make clean
```
- **åŠŸèƒ½**: åˆ é™¤æ‰€æœ‰ç”Ÿæˆçš„HTMLæŠ¥å‘Šæ–‡ä»¶
- **èŒƒå›´**: é€’å½’æŸ¥æ‰¾æ‰€æœ‰.htmlæ–‡ä»¶
- **å®‰å…¨æ€§**: åªåˆ é™¤HTMLæ–‡ä»¶

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æµ‹è¯•æµç¨‹
```bash
# 1. åˆ›å»ºç›®å½•ç»“æ„
make create-dirs

# 2. å¯åŠ¨æœåŠ¡
make start-service

# 3. ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆå‡ ç§’é’Ÿï¼‰
sleep 5

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
make health-check

# 5. æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
make test-all

# 6. ç”Ÿæˆæ‰€æœ‰æŠ¥å‘Š
make report-all

# 7. æŸ¥çœ‹æŠ¥å‘Šåˆ—è¡¨
make list-reports

# 8. åœæ­¢æœåŠ¡ï¼ˆå¯é€‰ï¼‰
make stop-service
```

### å•é¡¹åŠŸèƒ½æµ‹è¯•æµç¨‹
```bash
# 1. ç¡®ä¿æœåŠ¡è¿è¡Œ
make health-check

# 2. æ‰§è¡Œåˆ›å»ºåŠŸèƒ½æµ‹è¯•
make test-create

# 3. ç”Ÿæˆåˆ›å»ºåŠŸèƒ½æŠ¥å‘Š
make report-create

# 4. æŸ¥çœ‹æŠ¥å‘Š
open create/create_test_report.html
```

### å¼€å‘è°ƒè¯•æµç¨‹
```bash
# 1. åœæ­¢ç°æœ‰æœåŠ¡
make stop-service

# 2. å¯åŠ¨æœåŠ¡
make start-service

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
make health-check

# 4. æ‰§è¡Œç‰¹å®šæµ‹è¯•è¿›è¡Œè°ƒè¯•
make test-create

# 5. æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
make report-create
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æœåŠ¡ä¾èµ–
- ç¡®ä¿agent-factoryæœåŠ¡ä»£ç åœ¨æ­£ç¡®ä½ç½®
- ç¡®ä¿MySQLæ•°æ®åº“æ­£å¸¸è¿è¡Œ
- ç¡®ä¿åˆ†ç±»æ•°æ®å·²åˆå§‹åŒ–

### ç«¯å£å†²çª
- å¦‚æœ13021ç«¯å£è¢«å ç”¨ï¼Œå…ˆæ‰§è¡Œ`make stop-service`
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœåŠ¡å ç”¨è¯¥ç«¯å£

### æƒé™é—®é¢˜
- ç¡®ä¿æœ‰æƒé™è®¿é—®æµ‹è¯•å·¥å…·è·¯å¾„
- ç¡®ä¿æœ‰æƒé™åˆ›å»ºç›®å½•å’Œæ–‡ä»¶
- ç¡®ä¿æœ‰æƒé™killè¿›ç¨‹

### è·¯å¾„é…ç½®
- æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´TOOL_PATHå˜é‡
- ç¡®ä¿ç›¸å¯¹è·¯å¾„æ­£ç¡®

## ğŸ› æ•…éšœæ’é™¤

### æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :13021

# æ‰‹åŠ¨åœæ­¢è¿›ç¨‹
make stop-service

# é‡æ–°å¯åŠ¨
make start-service
```

### æµ‹è¯•å·¥å…·æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥å·¥å…·è·¯å¾„
ls -la /Users/Zhuanz/Work/as/dip_ws/agent-go-common-pkg/tool/apitesttool

# æ›´æ–°Makefileä¸­çš„TOOL_PATHå˜é‡
```

### æƒé™é”™è¯¯
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la api_test/tpl/

# åˆ›å»ºç›®å½•
make create-dirs
```

### æŠ¥å‘Šç”Ÿæˆå¤±è´¥
```bash
# æ£€æŸ¥reportsç›®å½•
ls -la reports/

# æ‰‹åŠ¨åˆ›å»ºç›®å½•
mkdir -p reports

# é‡æ–°ç”ŸæˆæŠ¥å‘Š
make report-all
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¹¶è¡Œæ‰§è¡Œ
- å•é¡¹æµ‹è¯•å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
- ä½¿ç”¨`&`ç¬¦å·å®ç°åå°æ‰§è¡Œ
- æ³¨æ„èµ„æºç«äº‰é—®é¢˜

### ç¼“å­˜ä¼˜åŒ–
- æµ‹è¯•å·¥å…·ä¼šç¼“å­˜ç¼–è¯‘ç»“æœ
- é‡å¤æ‰§è¡Œé€Ÿåº¦æ›´å¿«
- æ¸…ç†ç¼“å­˜å¯è§£å†³æŸäº›é—®é¢˜

### èµ„æºç®¡ç†
- åŠæ—¶æ¸…ç†æµ‹è¯•æ•°æ®
- ç›‘æ§å†…å­˜å’ŒCPUä½¿ç”¨
- é¿å…é•¿æ—¶é—´è¿è¡Œ

## ğŸ”„ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°æµ‹è¯•
1. åˆ›å»ºæ–°çš„æµ‹è¯•ç›®å½•
2. æ·»åŠ test_config.yamlæ–‡ä»¶
3. åœ¨Makefileä¸­æ·»åŠ å¯¹åº”å‘½ä»¤
4. æ›´æ–°helpä¿¡æ¯

### ä¿®æ”¹é…ç½®
1. è°ƒæ•´å˜é‡å®šä¹‰
2. æ›´æ–°è·¯å¾„é…ç½®
3. ä¿®æ”¹è¶…æ—¶è®¾ç½®
4. è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆ

### é›†æˆCI/CD
1. æ·»åŠ ç¯å¢ƒæ£€æŸ¥
2. é…ç½®è‡ªåŠ¨åŒ–æµç¨‹
3. é›†æˆæŠ¥å‘Šä¸Šä¼ 
4. æ·»åŠ é€šçŸ¥æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æœåŠ¡æ—¥å¿—
3. éªŒè¯ç¯å¢ƒé…ç½®
4. è”ç³»å¼€å‘å›¢é˜Ÿ 