apiVersion: v1
data:

  RDSHOST: {{ .Values.depServices.rds.host | quote}}
  RDSPORT: {{ quote .Values.depServices.rds.port }}
  RDSUSER: {{ .Values.depServices.rds.user | quote}}
  RDSPASS: {{ .Values.depServices.rds.password | quote}}
  DB_TYPE: {{ .Values.depServices.rds.type | quote}}
  RDSDBNAME: {{ .Values.depServices.rds.database | quote}}
  OPENSEARCH_HOST: {{ .Values.depServices.opensearch.host | quote}}
  OPENSEARCHRED: {{ .Values.depServices.opensearch.read | quote}}
  OPENSEARCHWRITE: {{ .Values.depServices.opensearch.write | quote}}
  OPENSEARCH_PORT: {{ quote .Values.depServices.opensearch.port }}
  OPENSEARCH_USER: {{ .Values.depServices.opensearch.user | quote}}
  OPENSEARCH_PASS: {{ .Values.depServices.opensearch.password | quote}}

  REDISCLUSTERMODE: {{ .Values.depServices.redis.connectType | quote }}
  REDISUSER: {{ .Values.depServices.redis.connectInfo.username | quote }}
  REDISPASS: {{ .Values.depServices.redis.connectInfo.password | quote }}
  {{- if eq .Values.depServices.redis.connectType "sentinel" }}
  REDISHOST: {{ .Values.depServices.redis.connectInfo.sentinelHost | quote }}
  REDISPORT: {{ .Values.depServices.redis.connectInfo.sentinelPort | quote }}
  SENTINELMASTER: {{ .Values.depServices.redis.connectInfo.masterGroupName | quote }}
  SENTINELUSER: {{ .Values.depServices.redis.connectInfo.sentinelUsername | quote }}
  SENTINELPASS: {{ .Values.depServices.redis.connectInfo.sentinelPassword | quote }}
  {{- else if eq .Values.depServices.redis.connectType "standalone" }}
  REDISHOST: {{ .Values.depServices.redis.connectInfo.host | quote }}
  REDISPORT: {{ .Values.depServices.redis.connectInfo.port | quote }}
  {{- else if eq .Values.depServices.redis.connectType "master-slave" }}
  REDISREADHOST: {{ .Values.depServices.redis.connectInfo.slaveHost | quote }}
  REDISREADPORT: {{ .Values.depServices.redis.connectInfo.slavePort | quote }}
  REDISREADUSER: {{ .Values.depServices.redis.connectInfo.username | quote }}
  REDISREADPASS: {{ .Values.depServices.redis.connectInfo.password | quote }}
  REDISWRITEHOST: {{ .Values.depServices.redis.connectInfo.masterHost | quote }}
  REDISWRITEPORT: {{ .Values.depServices.redis.connectInfo.masterPort | quote }}
  REDISWRITEUSER: {{ .Values.depServices.redis.connectInfo.username | quote }}
  REDISWRITEPASS: {{ .Values.depServices.redis.connectInfo.password | quote }}
  {{- end }}

  dm_svc.conf: |
    TIME_ZON=(480)
    LANGUAGE=(cn)
    DM={{ printf "(%s)" .Values.depServices.rds.host }}
    [DM]
    LOGIN_MODE=(1)

  agent-factory.yaml: |
    # 配置文件路径/sysvol/conf/agent-factory.yaml
    project:
      language: {{ .Values.service.language }}
      host: "0.0.0.0"
      port: {{ .Values.service.port }}
      logger_level: {{ .Values.service.loggerLevel }}
    hydra:
      user-mgnt:
        host: {{ .Values.depServices.hydra.userMgnt.host }}
        port: {{ .Values.depServices.hydra.userMgnt.port }}
      hydra-public:
        host: {{ .Values.depServices.hydra.hydraPublic.host }}
        port: {{ .Values.depServices.hydra.hydraPublic.port }}
      hydra-admin:
        host: {{ .Values.depServices.hydra.hydraAdmin.host }}
        port: {{ .Values.depServices.hydra.hydraAdmin.port }}
    model_factory:
      {{- toYaml .Values.depServices.modelFactory | nindent 6 }}
    eco_index:
      {{- toYaml .Values.depServices.ecoIndex | nindent 6 }}
    datahubcentral:
      {{- toYaml .Values.depServices.datahubcentral | nindent 6 }}
    authorization:
      {{- toYaml .Values.depServices.authorization | nindent 6 }}
    agent_factory:
      {{- toYaml .Values.depServices.agentFactory | nindent 6 }}
    biz_domain:
      {{- toYaml .Values.depServices.bizDomain | nindent 6 }}
  mq_config.yaml: |
    {{- toYaml .Values.depServices.mq | nindent 4 }}

kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-yaml
  namespace: {{ .Values.namespace }}
